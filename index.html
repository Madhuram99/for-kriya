<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A cute Valentine's Day page to ask someone to be your Valentine!">
  <meta name="theme-color" content="#1a0a2e">
  <title>for kriya ðŸ’Œ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Quicksand', sans-serif; }

    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #1a0a2e 0%, #2d1b69 25%, #44107a 50%, #893168 75%, #ff6b9d 100%);
      background-size: 400% 400%;
      animation: gradientShift 8s ease infinite;
      overflow: hidden;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Floating emojis */
    .floater {
      position: fixed;
      font-size: 1.5rem;
      opacity: 0.3;
      pointer-events: none;
      animation: floatUp linear infinite;
      z-index: 0;
    }
    @keyframes floatUp {
      0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
      10% { opacity: 0.3; }
      90% { opacity: 0.3; }
      100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
    }

    /* Glass card */
    .glass-card {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 24px;
      padding: 2.5rem 2rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 0 80px rgba(255, 105, 180, 0.05);
      position: relative;
      z-index: 1;
    }

    /* Image glow */
    #imageDisplay {
      border-radius: 20px;
      border: 3px solid rgba(255, 105, 180, 0.4);
      box-shadow: 0 0 30px rgba(255, 105, 180, 0.3), 0 0 60px rgba(147, 51, 234, 0.15);
      transition: transform 0.3s ease;
    }
    #imageDisplay:hover { transform: scale(1.02); }

    /* Gradient text */
    .gradient-text {
      background: linear-gradient(135deg, #ff6b9d, #c084fc, #ff6b9d, #fb7185);
      background-size: 300% 300%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: textShimmer 3s ease infinite;
    }
    @keyframes textShimmer {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Yes button - pill shaped, glowy */
    #yesButton {
      background: linear-gradient(135deg, #ff6b9d, #c084fc);
      border: none;
      border-radius: 50px;
      color: white;
      font-weight: 700;
      letter-spacing: 0.5px;
      box-shadow: 0 0 20px rgba(255, 107, 157, 0.4), 0 0 40px rgba(192, 132, 252, 0.2);
      animation: yesGlow 2s ease infinite, bounce 2s ease infinite;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    #yesButton:hover {
      box-shadow: 0 0 30px rgba(255, 107, 157, 0.6), 0 0 60px rgba(192, 132, 252, 0.4);
      transform: scale(1.05);
    }
    @keyframes yesGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 107, 157, 0.4), 0 0 40px rgba(192, 132, 252, 0.2); }
      50% { box-shadow: 0 0 30px rgba(255, 107, 157, 0.6), 0 0 60px rgba(192, 132, 252, 0.4); }
    }

    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-12px); }
      60% { transform: translateY(-6px); }
    }

    /* No button - smol, slay-proof */
    #noButton {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 50px;
      color: rgba(255, 255, 255, 0.7);
      font-weight: 600;
      cursor: pointer;
      position: relative;
      transition: transform 0.2s ease;
    }

    /* Sparkle cursor trail */
    .sparkle {
      position: fixed;
      pointer-events: none;
      font-size: 1rem;
      z-index: 99;
      animation: sparkleOut 0.8s ease forwards;
    }
    @keyframes sparkleOut {
      0% { transform: scale(1) rotate(0deg); opacity: 1; }
      100% { transform: scale(0) rotate(180deg) translateY(-30px); opacity: 0; }
    }

    /* Wrapped slideshow */
    .wrapped-overlay {
      position: fixed;
      inset: 0;
      z-index: 50;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.6s;
    }
    .wrapped-overlay.active { opacity: 1; }

    .wrapped-bg {
      position: absolute;
      inset: 0;
      transition: background 1.2s ease;
    }

    /* ====== GHIBLI SCENE SYSTEM ====== */
    .ghibli-scene {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
    }

    /* Fluffy cumulus clouds â€” shape built from base + bumps */
    .ghibli-cloud {
      position: absolute;
      background: #fff;
      border-radius: 100px;
      opacity: 0;
    }
    .ghibli-cloud::before,
    .ghibli-cloud::after {
      content: '';
      position: absolute;
      background: inherit;
      border-radius: 50%;
    }
    .ghibli-cloud::before {
      width: 55%;
      height: 130%;
      top: -40%;
      left: 15%;
    }
    .ghibli-cloud::after {
      width: 45%;
      height: 160%;
      top: -60%;
      right: 15%;
    }

    /* Cloud layers â€” near, mid, far for parallax depth */
    .cloud-near {
      animation: cloudDriftNear 20s linear infinite;
      opacity: 0.9;
    }
    .cloud-mid {
      animation: cloudDriftMid 30s linear infinite;
      opacity: 0.6;
    }
    .cloud-far {
      animation: cloudDriftFar 45s linear infinite;
      opacity: 0.35;
    }
    @keyframes cloudDriftNear {
      0%   { transform: translateX(110vw); }
      100% { transform: translateX(-300px); }
    }
    @keyframes cloudDriftMid {
      0%   { transform: translateX(110vw) scale(0.6); }
      100% { transform: translateX(-200px) scale(0.6); }
    }
    @keyframes cloudDriftFar {
      0%   { transform: translateX(110vw) scale(0.35); }
      100% { transform: translateX(-150px) scale(0.35); }
    }

    /* Rolling hills silhouette at bottom */
    .ghibli-hills {
      position: absolute;
      bottom: 0;
      left: -10%;
      width: 120%;
      height: 35%;
      pointer-events: none;
    }

    /* Twinkling stars */
    .ghibli-star {
      position: absolute;
      border-radius: 50%;
      background: #fffaf0;
      opacity: 0;
      animation: starTwinkle 3s ease-in-out infinite;
    }
    @keyframes starTwinkle {
      0%, 100% { opacity: 0.15; transform: scale(0.8); }
      50% { opacity: 0.95; transform: scale(1.3); }
    }

    /* Fireflies â€” warm glowing orbs */
    .ghibli-firefly {
      position: absolute;
      border-radius: 50%;
      opacity: 0;
      animation: fireflyGlow var(--fly-dur, 6s) ease-in-out infinite;
      animation-delay: var(--fly-delay, 0s);
    }
    @keyframes fireflyGlow {
      0%   { transform: translate(0, 0) scale(0.4); opacity: 0; }
      20%  { opacity: 0.9; }
      50%  { transform: translate(var(--fx), var(--fy)) scale(1); opacity: 0.5; }
      80%  { opacity: 0.9; }
      100% { transform: translate(var(--fx2), var(--fy2)) scale(0.4); opacity: 0; }
    }

    /* Floating dust motes / pollen for sunset scenes */
    .ghibli-mote {
      position: absolute;
      border-radius: 50%;
      opacity: 0;
      animation: moteFloat var(--mote-dur, 8s) ease-in-out infinite;
      animation-delay: var(--mote-delay, 0s);
    }
    @keyframes moteFloat {
      0%   { transform: translateY(0) scale(0.6); opacity: 0; }
      25%  { opacity: 0.5; }
      50%  { transform: translateY(var(--mote-y)) translateX(var(--mote-x)) scale(1); }
      75%  { opacity: 0.5; }
      100% { transform: translateY(calc(var(--mote-y) * 2)) translateX(calc(var(--mote-x) * 1.5)) scale(0.6); opacity: 0; }
    }

    /* Magical sparkles for final slide */
    .ghibli-sparkle {
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      opacity: 0;
      animation: sparkleRise var(--sp-dur, 5s) ease-out infinite;
      animation-delay: var(--sp-delay, 0s);
    }
    @keyframes sparkleRise {
      0%   { transform: translateY(0) scale(0); opacity: 0; }
      10%  { transform: translateY(-10px) scale(1); opacity: 1; }
      50%  { opacity: 0.6; }
      100% { transform: translateY(-120px) scale(0.3); opacity: 0; }
    }

    /* Soft vignette overlay */
    .ghibli-vignette {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      background: radial-gradient(ellipse at center, transparent 35%, rgba(0,0,0,0.35) 100%);
    }

    .wrapped-slide {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transform: scale(0.85);
      transition: opacity 0.5s ease, transform 0.6s cubic-bezier(0.22, 1, 0.36, 1);
      padding: 2rem;
      z-index: 1;
    }
    .wrapped-slide.show {
      opacity: 1;
      transform: scale(1);
    }

    /* Ken Burns: subtle zoom & pan on images */
    .wrapped-slide .img-wrapper {
      overflow: hidden;
      border-radius: 24px;
      border: 3px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 40px rgba(255, 105, 180, 0.15);
      max-height: 55vh;
      max-width: 80vw;
    }
    .wrapped-slide img {
      max-height: 55vh;
      max-width: 80vw;
      object-fit: contain;
      display: block;
      animation: none;
    }
    .wrapped-slide.show img {
      animation: kenBurns 6s ease-in-out forwards;
    }
    @keyframes kenBurns {
      0%   { transform: scale(1) translate(0, 0); }
      100% { transform: scale(1.08) translate(-1%, -1%); }
    }

    /* Video in slideshow */
    .wrapped-slide video {
      max-height: 55vh;
      max-width: 80vw;
      object-fit: contain;
      display: block;
      border-radius: 24px;
    }

    /* Caption animations */
    .wrapped-slide .caption {
      color: #fff;
      font-size: 1.5rem;
      font-weight: 700;
      margin-top: 1.5rem;
      text-align: center;
      text-shadow: 0 2px 20px rgba(0, 0, 0, 0.6);
      letter-spacing: 0.3px;
      opacity: 0;
      transform: translateY(20px);
      transition: none;
    }
    .wrapped-slide.show .caption {
      animation: captionIn 0.7s 0.3s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    }
    @keyframes captionIn {
      0%   { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .wrapped-slide .subcaption {
      color: rgba(255, 255, 255, 0.45);
      font-size: 0.85rem;
      margin-top: 0.5rem;
      font-weight: 500;
      opacity: 0;
      transform: translateY(10px);
    }
    .wrapped-slide.show .subcaption {
      animation: captionIn 0.5s 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    }

    /* Year label for each slide */
    .wrapped-slide .year-label {
      color: rgba(255, 255, 255, 0.3);
      font-size: 4rem;
      font-weight: 700;
      position: absolute;
      top: 4rem;
      left: 50%;
      transform: translateX(-50%);
      letter-spacing: 6px;
      opacity: 0;
    }
    .wrapped-slide.show .year-label {
      animation: yearFade 0.8s 0.1s ease forwards;
    }
    @keyframes yearFade {
      0%   { opacity: 0; transform: translateX(-50%) scale(0.8); }
      100% { opacity: 0.15; transform: translateX(-50%) scale(1); }
    }

    .wrapped-progress-container {
      position: fixed;
      top: 1rem;
      left: 1rem;
      right: 1rem;
      display: flex;
      gap: 4px;
      z-index: 60;
    }
    .wrapped-progress-segment {
      flex: 1;
      height: 3px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
      overflow: hidden;
    }
    .wrapped-progress-fill {
      height: 100%;
      background: #fff;
      width: 0%;
      border-radius: 2px;
      transition: none;
    }
    .wrapped-progress-segment.done .wrapped-progress-fill { width: 100%; }
    .wrapped-progress-segment.filling .wrapped-progress-fill {
      width: 100%;
      transition: width linear;
    }

    .wrapped-tap-hint {
      position: fixed;
      bottom: 2rem;
      color: rgba(255, 255, 255, 0.35);
      font-size: 0.85rem;
      font-weight: 600;
      z-index: 60;
      letter-spacing: 1px;
      text-transform: uppercase;
      animation: tapPulse 2s ease infinite;
    }
    @keyframes tapPulse {
      0%, 100% { opacity: 0.35; }
      50% { opacity: 0.7; }
    }

    /* Final slide special styles */
    .final-heart {
      font-size: 5rem;
      margin-bottom: 1rem;
      filter: drop-shadow(0 0 30px rgba(255, 107, 157, 0.6));
      animation: heartPulse 1.2s ease infinite;
    }
    @keyframes heartPulse {
      0%, 100% { transform: scale(1); }
      15% { transform: scale(1.15); }
      30% { transform: scale(1); }
      45% { transform: scale(1.1); }
      60% { transform: scale(1); }
    }
    .final-title {
      color: #fff;
      font-size: 2.2rem;
      font-weight: 700;
      text-align: center;
      line-height: 1.4;
      background: linear-gradient(135deg, #fff, #f9a8d4, #fff);
      background-size: 300% 300%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: textShimmer 3s ease infinite;
    }
    .final-subtitle {
      color: rgba(255, 255, 255, 0.6);
      font-size: 1.1rem;
      margin-top: 1rem;
      font-style: italic;
      opacity: 0;
      transform: translateY(15px);
    }
    .wrapped-slide.show .final-subtitle {
      animation: captionIn 0.7s 0.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    }
    .final-sign-off {
      color: rgba(255, 255, 255, 0.35);
      font-size: 0.85rem;
      margin-top: 1.5rem;
      font-weight: 600;
      letter-spacing: 2px;
      text-transform: uppercase;
      opacity: 0;
    }
    .wrapped-slide.show .final-sign-off {
      animation: captionIn 0.6s 1s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    }

    /* Floating hearts on final slide */
    .final-floating-heart {
      position: absolute;
      font-size: 1.2rem;
      opacity: 0;
      pointer-events: none;
      animation: floatHeart 4s ease-in-out infinite;
    }
    @keyframes floatHeart {
      0% { transform: translateY(0) scale(0.8); opacity: 0; }
      20% { opacity: 0.4; }
      80% { opacity: 0.4; }
      100% { transform: translateY(-100px) scale(1.2); opacity: 0; }
    }

    /* Replay button on final slide */
    .replay-btn {
      margin-top: 2rem;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 50px;
      color: rgba(255, 255, 255, 0.6);
      font-family: 'Quicksand', sans-serif;
      font-size: 0.85rem;
      font-weight: 600;
      padding: 0.5rem 1.5rem;
      cursor: pointer;
      letter-spacing: 1px;
      opacity: 0;
      transition: all 0.3s ease;
    }
    .wrapped-slide.show .replay-btn {
      animation: captionIn 0.5s 1.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    }
    .replay-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      color: #fff;
    }

    /* subtext under question */
    .subtext {
      color: rgba(255, 255, 255, 0.4);
      font-size: 0.85rem;
      font-weight: 500;
      letter-spacing: 2px;
      text-transform: uppercase;
    }
  </style>
  <!-- Preload images -->
  <link rel="preload" as="image" href="./images/image1.gif">
  <link rel="preload" as="image" href="./images/image2.gif">
  <link rel="preload" as="image" href="./images/image3.gif">
  <link rel="preload" as="image" href="./images/image4.gif">
  <link rel="preload" as="image" href="./images/image5.gif">
  <link rel="preload" as="image" href="./images/image6.gif">
  <link rel="preload" as="image" href="./images/image7.gif">
</head>
<body>
  <!-- Background music â€” playsinline for iOS -->
  <audio id="bgMusic" loop preload="auto" playsinline webkit-playsinline>
    <source src="./Die With A Smile-(SambalpuriStar.In).mp3" type="audio/mpeg">
  </audio>

  <!-- Floating emoji background -->
  <div id="floaters"></div>

  <main class="flex items-center justify-center h-screen relative z-10">
    <section class="glass-card flex flex-col items-center max-w-md mx-4">
      <img
        id="imageDisplay"
        src="./images/image1.gif"
        alt="Hello Kitty with hearts"
        class="h-[260px] w-auto object-contain"
      />
      <p class="subtext mt-4 mb-1">âœ¨ for the prettiest girl i know âœ¨</p>
      <h1 id="valentineQuestion" class="text-3xl font-bold gradient-text text-center my-2 leading-snug">
        Kriya, will you be my Valentine?
      </h1>
      <div id="responseButtons" class="flex gap-5 pt-6 items-center">
        <button
          id="yesButton"
          class="text-xl px-8 py-3 min-w-[100px]"
        >
          yes pls ðŸ’—
        </button>
        <button
          id="noButton"
          class="text-base px-5 py-2 min-w-[70px]"
        >
          No
        </button>
      </div>
    </section>
  </main>

  <script>
    (() => {
      // ---- BACKGROUND MUSIC â€” iOS-compatible unlock ----
      const bgMusic = document.getElementById('bgMusic');
      bgMusic.volume = 0.5;
      bgMusic.load(); // kick off buffering early

      let musicPlaying = false;

      function tryPlayMusic() {
        if (musicPlaying) return;
        // iOS needs currentTime reset before play in a gesture handler
        bgMusic.currentTime = 0;
        const p = bgMusic.play();
        if (p && p.then) {
          p.then(() => {
            musicPlaying = true;
            removeListeners();
          }).catch(() => {
            // iOS sometimes needs a re-load then play on next gesture
            bgMusic.load();
          });
        }
      }

      function removeListeners() {
        ['click', 'touchstart', 'touchend', 'pointerdown'].forEach(evt => {
          document.removeEventListener(evt, tryPlayMusic, true);
        });
      }

      // Attach on every possible gesture type â€” iOS is picky
      ['click', 'touchstart', 'touchend', 'pointerdown'].forEach(evt => {
        document.addEventListener(evt, tryPlayMusic, true);
      });

      // Also try on visibility change (e.g. user switches back to tab)
      document.addEventListener('visibilitychange', () => {
        if (!document.hidden && musicPlaying && bgMusic.paused) {
          bgMusic.play().catch(() => {});
        }
      });

      // ---- FLOATING EMOJIS ----
      const emojis = ['ðŸ’—', 'âœ¨', 'ðŸ¦‹', 'ðŸ’Œ', 'ðŸŒ¸', 'ðŸ’•', 'â­', 'ðŸŽ€', 'ðŸ’œ', 'ðŸ©·'];
      const floaterContainer = document.getElementById('floaters');
      function spawnFloater() {
        const el = document.createElement('div');
        el.className = 'floater';
        el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
        el.style.left = Math.random() * 100 + 'vw';
        el.style.animationDuration = (8 + Math.random() * 12) + 's';
        el.style.fontSize = (1 + Math.random() * 1.5) + 'rem';
        floaterContainer.appendChild(el);
        el.addEventListener('animationend', () => el.remove());
      }
      // Spawn initial batch
      for (let i = 0; i < 15; i++) setTimeout(spawnFloater, i * 300);
      setInterval(spawnFloater, 800);

      // ---- SPARKLE CURSOR ----
      let lastSparkle = 0;
      document.addEventListener('mousemove', (e) => {
        if (Date.now() - lastSparkle < 100) return;
        lastSparkle = Date.now();
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.textContent = ['âœ¨', 'ðŸ’—', 'â­', 'ðŸ©·'][Math.floor(Math.random() * 4)];
        sparkle.style.left = e.clientX + 'px';
        sparkle.style.top = e.clientY + 'px';
        document.body.appendChild(sparkle);
        sparkle.addEventListener('animationend', () => sparkle.remove());
      });

      // ---- DOM REFS ----
      const yesButton = document.getElementById('yesButton');
      const noButton = document.getElementById('noButton');
      const imageDisplay = document.getElementById('imageDisplay');
      const valentineQuestion = document.getElementById('valentineQuestion');
      const responseButtons = document.getElementById('responseButtons');

      const GROWTH_PER_CLICK = 35;
      const FONT_GROWTH_PER_CLICK = 25;
      const MAX_NO_CLICKS = 5;

      const IMAGE_PATHS = [
        './images/image1.gif',
        './images/image2.gif',
        './images/image3.gif',
        './images/image4.gif',
        './images/image5.gif',
        './images/image6.gif',
        './images/image7.gif',
      ];

      const NO_BUTTON_MESSAGES = [
        'No',
        'Kriya are you sure? ðŸ¥º',
        'Pookie please',
        "Kriya don't do this to me :(",
        "You're breaking my heart ðŸ’”",
        "I'm gonna cry Kriya...",
      ];

      const ALT_TEXTS = [
        'Hello Kitty with hearts',
        'Hello Kitty saying pretty please',
        'Hello Kitty begging with hearts',
        'Sad Hello Kitty with falling stars',
        'Hello Kitty crying',
        'Hello Kitty shedding tears',
        'Hello Kitty celebrating yay',
      ];

      const WRAPPED_SLIDES = [
        { type: 'image', src: './images/WhatsApp Image 2026-02-13 at 02.20.43.jpeg' },
        { type: 'image', src: './images/WhatsApp Image 2026-02-13 at 02.20.43 (1).jpeg' },
        { type: 'image', src: './images/WhatsApp Image 2026-02-13 at 02.24.16.jpeg' },
        { type: 'video', src: './images/WhatsApp Video 2026-02-13 at 03.36.16.mp4' },
      ];

      const WRAPPED_CAPTIONS = [
        "cute since day one, no debate ðŸ’—",
        "giving main character energy since forever ðŸ« ",
        "and then you grew up and chose violence ðŸ’•",
        "those kajal eyes & that smile? nobody stood a chance ðŸ« ",
      ];

      // Ghibli scene definitions â€” each slide is a full scene
      const GHIBLI_SCENES = [
        {
          // Slide 1: Spirited Away sunset sky â€” warm, golden hour
          bg: 'linear-gradient(180deg, #2d1b4e 0%, #6b3a7d 15%, #c97b8b 40%, #f4a582 65%, #fdd6b0 85%, #f1dbb6 100%)',
          scene: 'sunset',
          cloudColor: '#fff8f0',
          cloudShadow: '#e8c0a8',
          hillColors: ['#7d9b5f', '#4a8b5c', '#2d6b4f'],
        },
        {
          // Slide 2: Howl's sky â€” classic Ghibli daytime blue with warm horizon
          bg: 'linear-gradient(180deg, #1a2a5e 0%, #3a6fa0 20%, #7db8d4 45%, #8FB1E9 60%, #c7dff0 78%, #e8d5e0 100%)',
          scene: 'daytime',
          cloudColor: '#ffffff',
          cloudShadow: '#c7dff0',
          hillColors: ['#A6D784', '#8CBF88', '#5a8a5c'],
        },
        {
          // Slide 3: Night sky â€” deep indigo with star field, radial for horizon glow
          bg: 'radial-gradient(ellipse at 50% 100%, #3d4f7c 0%, #1e2952 30%, #131b3a 55%, #0a0e23 100%)',
          scene: 'night',
          hillColors: ['#1a2040', '#121830', '#0a0e20'],
        },
        {
          // Slide 4: Mononoke forest â€” deep greens, firefly glow
          bg: 'linear-gradient(180deg, #041A40 0%, #0a1a12 20%, #14332a 45%, #1a4d3a 70%, #2d6b4f 100%)',
          scene: 'forest',
          hillColors: ['#2d6b4f', '#1a4d3a', '#0a1a12'],
        },
        {
          // Final: Magical â€” celestial pink aurora with rising sparkles
          bg: 'radial-gradient(ellipse at 50% 80%, #7b4a9e 0%, #3d1d6b 35%, #1a0a2e 70%)',
          scene: 'magic',
        },
      ];

      let noClickCount = 0;
      let buttonHeight = 48;
      let buttonWidth = 100;
      let fontSize = 20;

      // ---- NO BUTTON DODGE (uses transform, stays in place, with cooldown) ----
      let dodgeCount = 0;
      let offsetX = 0;
      let offsetY = 0;
      let dodgeCooldown = false;

      function dodgeNoButton() {
        if (dodgeCooldown) return;
        dodgeCooldown = true;
        setTimeout(() => { dodgeCooldown = false; }, 300);

        // Pick a random nudge direction
        const directions = [
          { x: 150, y: 0 }, { x: -150, y: 0 },
          { x: 0, y: 100 }, { x: 0, y: -100 },
          { x: 100, y: -80 }, { x: -100, y: -80 },
          { x: 100, y: 80 }, { x: -100, y: 80 },
        ];
        const dir = directions[Math.floor(Math.random() * directions.length)];
        offsetX += dir.x;
        offsetY += dir.y;

        // Keep within reasonable bounds from original spot
        offsetX = Math.max(-300, Math.min(300, offsetX));
        offsetY = Math.max(-250, Math.min(250, offsetY));

        noButton.style.transform = `translate(${offsetX}px, ${offsetY}px)`;

        // Change Hello Kitty image on each dodge
        dodgeCount++;
        const imgIndex = Math.min(dodgeCount, IMAGE_PATHS.length - 2);
        imageDisplay.src = IMAGE_PATHS[imgIndex];
        imageDisplay.alt = ALT_TEXTS[imgIndex];

        // Grow yes button & update no text
        if (dodgeCount <= MAX_NO_CLICKS) {
          buttonHeight += GROWTH_PER_CLICK;
          buttonWidth += GROWTH_PER_CLICK;
          fontSize += FONT_GROWTH_PER_CLICK;
          yesButton.style.height = `${buttonHeight}px`;
          yesButton.style.width = `${buttonWidth}px`;
          yesButton.style.fontSize = `${fontSize}px`;
          noButton.textContent = NO_BUTTON_MESSAGES[Math.min(dodgeCount, NO_BUTTON_MESSAGES.length - 1)];
        }
      }

      // Desktop: dodge on hover
      noButton.addEventListener('mouseenter', dodgeNoButton);

      // Mobile: intercept touch and dodge instead of clicking
      noButton.addEventListener('touchstart', (e) => {
        e.preventDefault();
        dodgeNoButton();
      }, { passive: false });

      // ---- YES â†’ WRAPPED ----
      yesButton.addEventListener('click', () => {
        imageDisplay.src = IMAGE_PATHS[IMAGE_PATHS.length - 1];
        imageDisplay.alt = ALT_TEXTS[ALT_TEXTS.length - 1];
        valentineQuestion.innerHTML = 'YAAYYY KRIYA!! ðŸŽ‰';
        const sub = document.querySelector('.subtext');
        if (sub) sub.textContent = "i knew you'd say yes ðŸ¥¹";
        responseButtons.style.display = 'none';

        const heart = confetti.shapeFromPath({
          path: 'M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z',
        });
        const defaults = { spread: 360, ticks: 100, gravity: 0, decay: 0.94, startVelocity: 20, shapes: [heart], colors: ['#ff6b9d', '#c084fc', '#fb7185', '#a78bfa', '#f9a8d4'] };
        confetti({ ...defaults, particleCount: 50, scalar: 2 });
        confetti({ ...defaults, particleCount: 25, scalar: 3 });
        confetti({ ...defaults, particleCount: 10, scalar: 4 });

        // Preload slideshow media during YAAYYY screen
        WRAPPED_SLIDES.forEach(s => {
          if (s.type === 'image') { new Image().src = s.src; }
        });

        setTimeout(startWrapped, 3500);
      });

      // ---- GHIBLI SCENE BUILDER ----
      function buildGhibliScene(container, scene) {
        container.innerHTML = '';

        // 1. Fluffy cumulus clouds (sunset + daytime scenes)
        if (scene.scene === 'sunset' || scene.scene === 'daytime') {
          // Far clouds (small, slow, faded)
          for (let i = 0; i < 3; i++) {
            const c = document.createElement('div');
            c.className = 'ghibli-cloud cloud-far';
            c.style.width = (60 + Math.random() * 80) + 'px';
            c.style.height = (20 + Math.random() * 15) + 'px';
            c.style.background = scene.cloudShadow;
            c.style.top = (8 + i * 10 + Math.random() * 5) + '%';
            c.style.animationDelay = (-Math.random() * 45) + 's';
            container.appendChild(c);
          }
          // Mid clouds
          for (let i = 0; i < 2; i++) {
            const c = document.createElement('div');
            c.className = 'ghibli-cloud cloud-mid';
            c.style.width = (100 + Math.random() * 100) + 'px';
            c.style.height = (30 + Math.random() * 20) + 'px';
            c.style.background = `linear-gradient(180deg, ${scene.cloudColor} 60%, ${scene.cloudShadow})`;
            c.style.top = (15 + i * 12 + Math.random() * 8) + '%';
            c.style.animationDelay = (-Math.random() * 30) + 's';
            container.appendChild(c);
          }
          // Near cloud (big, bright, fast)
          const near = document.createElement('div');
          near.className = 'ghibli-cloud cloud-near';
          near.style.width = (160 + Math.random() * 80) + 'px';
          near.style.height = (45 + Math.random() * 20) + 'px';
          near.style.background = `linear-gradient(180deg, ${scene.cloudColor} 50%, ${scene.cloudShadow})`;
          near.style.top = (20 + Math.random() * 15) + '%';
          near.style.animationDelay = (-Math.random() * 20) + 's';
          container.appendChild(near);
        }

        // 2. Rolling hills silhouette (sunset, daytime, forest, night)
        if (scene.hillColors) {
          const hills = document.createElement('div');
          hills.className = 'ghibli-hills';
          // 3 layers of overlapping hills using radial gradients
          const [c1, c2, c3] = scene.hillColors;
          hills.style.background = `
            radial-gradient(ellipse at 25% 100%, ${c1} 0%, transparent 55%),
            radial-gradient(ellipse at 75% 100%, ${c2} 0%, transparent 50%),
            radial-gradient(ellipse at 50% 100%, ${c3} 0%, transparent 65%)
          `;
          container.appendChild(hills);
        }

        // 3. Star field (night scene)
        if (scene.scene === 'night') {
          for (let i = 0; i < 55; i++) {
            const s = document.createElement('div');
            s.className = 'ghibli-star';
            const size = 1 + Math.random() * 2.5;
            s.style.width = size + 'px';
            s.style.height = size + 'px';
            s.style.left = (Math.random() * 100) + '%';
            s.style.top = (Math.random() * 55) + '%';
            s.style.animationDelay = (Math.random() * 4) + 's';
            s.style.animationDuration = (2 + Math.random() * 4) + 's';
            s.style.boxShadow = `0 0 ${size * 2}px #fffaf0, 0 0 ${size * 4}px rgba(190,169,222,0.3)`;
            container.appendChild(s);
          }
        }

        // 4. Fireflies (forest scene)
        if (scene.scene === 'forest') {
          const flyColors = ['#d4e85e', '#a8d840', '#f0e68c', '#c8e060'];
          for (let i = 0; i < 18; i++) {
            const f = document.createElement('div');
            f.className = 'ghibli-firefly';
            const size = 3 + Math.random() * 4;
            const col = flyColors[i % flyColors.length];
            f.style.width = size + 'px';
            f.style.height = size + 'px';
            f.style.left = (10 + Math.random() * 80) + '%';
            f.style.top = (15 + Math.random() * 55) + '%';
            f.style.background = col;
            f.style.boxShadow = `0 0 ${size*3}px ${col}, 0 0 ${size*8}px ${col}50`;
            f.style.setProperty('--fx', (Math.random() * 50 - 25) + 'px');
            f.style.setProperty('--fy', (Math.random() * 40 - 20) + 'px');
            f.style.setProperty('--fx2', (Math.random() * 70 - 35) + 'px');
            f.style.setProperty('--fy2', (Math.random() * 50 - 40) + 'px');
            f.style.setProperty('--fly-dur', (5 + Math.random() * 5) + 's');
            f.style.setProperty('--fly-delay', (Math.random() * 5) + 's');
            container.appendChild(f);
          }
        }

        // 5. Floating pollen / dust motes (sunset scene)
        if (scene.scene === 'sunset') {
          const moteColors = ['#fdd6b0', '#f4a582', '#ffcc99', '#ffe0c0'];
          for (let i = 0; i < 15; i++) {
            const m = document.createElement('div');
            m.className = 'ghibli-mote';
            const size = 2 + Math.random() * 4;
            const col = moteColors[i % moteColors.length];
            m.style.width = size + 'px';
            m.style.height = size + 'px';
            m.style.left = (Math.random() * 100) + '%';
            m.style.top = (30 + Math.random() * 50) + '%';
            m.style.background = col;
            m.style.boxShadow = `0 0 ${size*2}px ${col}80`;
            m.style.setProperty('--mote-y', (-30 - Math.random() * 40) + 'px');
            m.style.setProperty('--mote-x', (Math.random() * 30 - 15) + 'px');
            m.style.setProperty('--mote-dur', (6 + Math.random() * 6) + 's');
            m.style.setProperty('--mote-delay', (Math.random() * 6) + 's');
            container.appendChild(m);
          }
        }

        // 6. Magical rising sparkles (magic/final scene)
        if (scene.scene === 'magic') {
          const spColors = ['#f9a8d4', '#c084fc', '#ff6b9d', '#e0b0ff', '#ffc0e0'];
          for (let i = 0; i < 25; i++) {
            const sp = document.createElement('div');
            sp.className = 'ghibli-sparkle';
            const col = spColors[i % spColors.length];
            sp.style.left = (5 + Math.random() * 90) + '%';
            sp.style.top = (50 + Math.random() * 45) + '%';
            sp.style.background = col;
            sp.style.boxShadow = `0 0 6px ${col}, 0 0 12px ${col}60`;
            sp.style.setProperty('--sp-dur', (3 + Math.random() * 4) + 's');
            sp.style.setProperty('--sp-delay', (Math.random() * 5) + 's');
            container.appendChild(sp);
          }
        }

        // 7. Gentle motes for daytime scene (dandelion-like)
        if (scene.scene === 'daytime') {
          const dayMotes = ['#ffffff', '#f0f0ff', '#e8f0ff'];
          for (let i = 0; i < 10; i++) {
            const m = document.createElement('div');
            m.className = 'ghibli-mote';
            const size = 2 + Math.random() * 3;
            const col = dayMotes[i % dayMotes.length];
            m.style.width = size + 'px';
            m.style.height = size + 'px';
            m.style.left = (Math.random() * 100) + '%';
            m.style.top = (20 + Math.random() * 50) + '%';
            m.style.background = col;
            m.style.boxShadow = `0 0 ${size*2}px ${col}`;
            m.style.setProperty('--mote-y', (-20 - Math.random() * 30) + 'px');
            m.style.setProperty('--mote-x', (Math.random() * 20 - 10) + 'px');
            m.style.setProperty('--mote-dur', (8 + Math.random() * 6) + 's');
            m.style.setProperty('--mote-delay', (Math.random() * 8) + 's');
            container.appendChild(m);
          }
        }
      }

      // ---- SPOTIFY WRAPPED SLIDESHOW ----
      const SLIDE_DURATION = 5000; // 5 seconds per slide auto-advance
      const WRAPPED_YEARS = ['', '', '', ''];

      function startWrapped() {
        const overlay = document.createElement('div');
        overlay.className = 'wrapped-overlay';

        const bg = document.createElement('div');
        bg.className = 'wrapped-bg';
        overlay.appendChild(bg);

        // Ghibli scene container
        const ghibliScene = document.createElement('div');
        ghibliScene.className = 'ghibli-scene';
        overlay.appendChild(ghibliScene);

        const ghibliVignette = document.createElement('div');
        ghibliVignette.className = 'ghibli-vignette';
        overlay.appendChild(ghibliVignette);

        // Story-style segmented progress bar
        const progressContainer = document.createElement('div');
        progressContainer.className = 'wrapped-progress-container';
        const totalSlides = WRAPPED_SLIDES.length + 1;
        const segments = [];
        for (let i = 0; i < totalSlides; i++) {
          const seg = document.createElement('div');
          seg.className = 'wrapped-progress-segment';
          const fill = document.createElement('div');
          fill.className = 'wrapped-progress-fill';
          seg.appendChild(fill);
          progressContainer.appendChild(seg);
          segments.push({ seg, fill });
        }

        const tapHint = document.createElement('div');
        tapHint.className = 'wrapped-tap-hint';
        tapHint.textContent = 'tap to continue â†’';

        overlay.appendChild(progressContainer);
        overlay.appendChild(tapHint);

        // Create slides (image or video)
        const slides = WRAPPED_SLIDES.map((media, i) => {
          const slide = document.createElement('div');
          slide.className = 'wrapped-slide';

          // Year label in background
          if (WRAPPED_YEARS[i]) {
            const yearLabel = document.createElement('div');
            yearLabel.className = 'year-label';
            yearLabel.textContent = WRAPPED_YEARS[i];
            slide.appendChild(yearLabel);
          }

          if (media.type === 'video') {
            const imgWrapper = document.createElement('div');
            imgWrapper.className = 'img-wrapper';
            const vid = document.createElement('video');
            vid.src = media.src;
            vid.muted = true;
            vid.playsInline = true;
            vid.loop = true;
            vid.setAttribute('playsinline', '');
            vid.setAttribute('webkit-playsinline', '');
            imgWrapper.appendChild(vid);
            slide.appendChild(imgWrapper);
            slide._video = vid;
          } else {
            const imgWrapper = document.createElement('div');
            imgWrapper.className = 'img-wrapper';
            const img = document.createElement('img');
            img.src = media.src;
            img.alt = `Photo of Kriya ${i + 1}`;
            imgWrapper.appendChild(img);
            slide.appendChild(imgWrapper);
          }

          const caption = document.createElement('div');
          caption.className = 'caption';
          caption.textContent = WRAPPED_CAPTIONS[i];
          const subcaption = document.createElement('div');
          subcaption.className = 'subcaption';
          subcaption.textContent = `${i + 1} of ${WRAPPED_SLIDES.length}`;
          slide.appendChild(caption);
          slide.appendChild(subcaption);
          overlay.appendChild(slide);
          return slide;
        });

        // Final slide - much more impactful
        const finalSlide = document.createElement('div');
        finalSlide.className = 'wrapped-slide';
        finalSlide.innerHTML = `
          <div class="final-heart">ðŸ’—</div>
          <div class="final-title">
            Happy Valentine's Day, Kriya
          </div>
          <div class="final-subtitle">you were always the prettiest person in every room ðŸ¥¹</div>
          <div class="final-sign-off">â€” yours, always ðŸ’Œ</div>
          <button class="replay-btn" id="replayBtn">watch again â†»</button>
        `;
        // Add floating hearts to final slide
        const heartEmojis = ['ðŸ’—', 'ðŸ’•', 'ðŸ©·', 'ðŸ’œ', 'ðŸŒ¸'];
        for (let i = 0; i < 12; i++) {
          const fh = document.createElement('div');
          fh.className = 'final-floating-heart';
          fh.textContent = heartEmojis[i % heartEmojis.length];
          fh.style.left = (10 + Math.random() * 80) + '%';
          fh.style.top = (20 + Math.random() * 60) + '%';
          fh.style.animationDelay = (Math.random() * 4) + 's';
          fh.style.animationDuration = (3 + Math.random() * 3) + 's';
          fh.style.fontSize = (0.8 + Math.random() * 1) + 'rem';
          finalSlide.appendChild(fh);
        }
        overlay.appendChild(finalSlide);
        slides.push(finalSlide);

        document.body.appendChild(overlay);
        requestAnimationFrame(() => overlay.classList.add('active'));

        let current = 0;
        let autoTimer = null;

        function showSlide(index) {
          // Clear any pending auto-advance
          if (autoTimer) { clearTimeout(autoTimer); autoTimer = null; }

          // Pause any playing videos & reset all slides
          slides.forEach(s => {
            s.classList.remove('show');
            if (s._video) { s._video.pause(); s._video.currentTime = 0; }
          });
          slides[index].classList.add('show');
          // Auto-play video if this slide has one
          if (slides[index]._video) {
            slides[index]._video.play().catch(() => {});
          }
          // Apply Ghibli scene for this slide
          const sceneData = GHIBLI_SCENES[index % GHIBLI_SCENES.length];
          bg.style.background = sceneData.bg;
          buildGhibliScene(ghibliScene, sceneData);

          // Update progress segments
          segments.forEach((s, i) => {
            s.seg.classList.remove('filling');
            if (i < index) {
              s.seg.classList.add('done');
              s.fill.style.width = '100%';
            } else {
              s.seg.classList.remove('done');
              s.fill.style.width = '0%';
            }
          });

          // Animate current segment fill over SLIDE_DURATION
          requestAnimationFrame(() => {
            const currentSeg = segments[index];
            currentSeg.fill.style.transitionDuration = (SLIDE_DURATION / 1000) + 's';
            currentSeg.seg.classList.add('filling');
          });

          // Heart confetti on each slide
          const heart = confetti.shapeFromPath({
            path: 'M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z',
          });
          confetti({ particleCount: 15, spread: 360, gravity: 0, decay: 0.95, startVelocity: 12, shapes: [heart], colors: ['#ff6b9d', '#c084fc', '#fb7185', '#a78bfa'], scalar: 2 });

          if (index === slides.length - 1) {
            tapHint.style.display = 'none';
            // Big finale confetti burst
            setTimeout(() => {
              confetti({ particleCount: 80, spread: 360, gravity: 0, decay: 0.94, startVelocity: 25, shapes: [heart], colors: ['#ff6b9d', '#c084fc', '#fb7185', '#a78bfa', '#f9a8d4'], scalar: 3 });
            }, 300);
            setTimeout(() => {
              confetti({ particleCount: 40, spread: 360, gravity: 0, decay: 0.94, startVelocity: 18, shapes: [heart], colors: ['#ff6b9d', '#c084fc', '#fb7185'], scalar: 2.5 });
            }, 800);
            return;
          }

          // Auto-advance after SLIDE_DURATION
          autoTimer = setTimeout(() => {
            if (current < slides.length - 1) {
              current++;
              showSlide(current);
            }
          }, SLIDE_DURATION);
        }

        function nextSlide() {
          if (current < slides.length - 1) {
            current++;
            showSlide(current);
          }
        }

        overlay.addEventListener('click', (e) => {
          if (e.target.id === 'replayBtn') return;
          nextSlide();
        });

        // Replay button restarts from first slide
        finalSlide.querySelector('#replayBtn').addEventListener('click', (e) => {
          e.stopPropagation();
          current = 0;
          tapHint.style.display = '';
          tapHint.textContent = 'tap to continue â†’';
          showSlide(0);
        });

        setTimeout(() => showSlide(0), 100);
      }
    })();
  </script>
</body>
</html>
